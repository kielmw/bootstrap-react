<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>getStudent</title>
    <link rel="stylesheet" href="../node_modules/bootstrap/dist/css/bootstrap.css">
</head>
<body>
    <div class="container-md border mt-3">
        <h1>Data from API</h1>
        <div class="mb-3">
            <button id="fetchButton" class="btn btn-primary">Fetch Data</button>
            <button id="newKelasButton" class="btn btn-success"> + Kelas</button>
        </div>

        <div id="data-container" class="mt-3">
            <!-- Data will be injected here -->
        </div>
    </div>

    <script src="../node_modules/bootstrap/dist/js/bootstrap.bundle.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Event listener for the "Fetch Data" button
            document.getElementById('fetchButton').addEventListener('click', () => {
                const apiUrl = `http://localhost:3000/api/kontrol-kelas`;

                fetch(apiUrl, {
                    method: 'GET'
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok: ' + response.statusText);
                    }

                    const contentType = response.headers.get('content-type');
                    if (!contentType || !contentType.includes('application/json')) {
                        throw new TypeError('Received non-JSON response');
                    }

                    return response.json();
                })
                .then(data => {
                    const dataContainer = document.getElementById('data-container');
                    dataContainer.innerHTML = ''; // Clear previous data

                    // Create the table
                    const table = document.createElement('table');
                    table.className = 'table table-striped';

                    // Create the table header
                    const thead = document.createElement('thead');
                    const headerRow = document.createElement('tr');

                    const idKelasHeader = document.createElement('th');
                    idKelasHeader.textContent = 'ID Kelas';
                    headerRow.appendChild(idKelasHeader);

                    const namaKelasHeader = document.createElement('th');
                    namaKelasHeader.textContent = 'Nama Kelas';
                    headerRow.appendChild(namaKelasHeader);

                    const namaGuruHeader = document.createElement('th');
                    namaGuruHeader.textContent = 'Nama Guru';
                    headerRow.appendChild(namaGuruHeader);

                    const deskripsiKelasHeader = document.createElement('th');
                    deskripsiKelasHeader.textContent = 'Deskripsi Kelas';
                    headerRow.appendChild(deskripsiKelasHeader);

                    const editHeader = document.createElement('th');
                    editHeader.textContent = 'Edit';
                    headerRow.appendChild(editHeader);

                    thead.appendChild(headerRow);
                    table.appendChild(thead);

                    // Create the table body
                    const tbody = document.createElement('tbody');
                    
                    data.forEach(item => {
                        const dataRow = document.createElement('tr');

                        const idKelasCell = document.createElement('td');
                        idKelasCell.textContent = item.idKelas;
                        dataRow.appendChild(idKelasCell);

                        const namaKelasCell = document.createElement('td');
                        namaKelasCell.textContent = item.namaKelas;
                        dataRow.appendChild(namaKelasCell);

                        const namaGuruCell = document.createElement('td');
                        namaGuruCell.textContent = item.namaGuru;
                        dataRow.appendChild(namaGuruCell);

                        const deskripsiKelasCell = document.createElement('td');
                        deskripsiKelasCell.textContent = item.deskripsiKelas;
                        dataRow.appendChild(deskripsiKelasCell);

                        const editButtonCell = document.createElement('td');
                        const editButton = document.createElement('button');
                        editButton.textContent = 'Edit';
                        editButton.className = 'btn btn-primary';
                        // Add click event listener for edit button
                        editButton.addEventListener('click', () => {
                            // Navigate to editKelas.html page with ID as parameter
                            window.location.href = `editKelas.html?id=${item.idKelas}`;
                        });
                        editButtonCell.appendChild(editButton);
                        dataRow.appendChild(editButtonCell);

                        tbody.appendChild(dataRow);
                    });

                    table.appendChild(tbody);
                    dataContainer.appendChild(table);
                })
                .catch(error => {
                    const dataContainer = document.getElementById('data-container');
                    dataContainer.innerHTML = ''; // Clear previous data
                    const errorElement = document.createElement('div');
                    errorElement.className = 'alert alert-danger';
                    errorElement.textContent = `Error fetching data: ${error.message}`;
                    dataContainer.appendChild(errorElement);
                });
            });

            // Event listener for the "New Kelas" button
            document.getElementById('newKelasButton').addEventListener('click', () => {
                // Navigate to newKelas.html page
                window.location.href = 'newKelas.html';
            });
        });
    </script>
</body>
</html>
